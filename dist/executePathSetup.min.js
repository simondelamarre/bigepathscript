"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P((function(resolve){resolve(value)}))).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__asyncValues=this&&this.__asyncValues||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise((function(resolve,reject){(function(resolve,reject,d,v){Promise.resolve(v).then((function(v){resolve({value:v,done:d})}),reject)})(resolve,reject,(v=o[n](v)).done,v.value)}))}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getItem=exports.processListItem=exports.processScrollToBottom=exports.processLoadMoreButton=void 0;const scrollToBottom_1=require("./events/scrollToBottom"),scrollToElement_1=require("./events/scrollToElement"),productScheme_1=require("./parsers/productScheme");exports.default=setup=>__awaiter(void 0,void 0,void 0,(function*(){var e_1,_a;const response={static:{},list:[]};for(const stat of setup.static){const statElement=document.querySelector(stat.selector);response.static[stat.label]=statElement.textContent}if("loadMoreButton"===setup.navigation.mode)return exports.processLoadMoreButton(setup,response.list,(function(response){return response.list=response,response}));if("scrollToBottom"===setup.navigation.mode)return exports.processScrollToBottom(setup,response.list,(function(response){return response}));if("nextButton"===setup.navigation.mode){try{for(var _c,_b=__asyncValues(setup.lists);!(_c=yield _b.next()).done;){const list=_c.value;response.list=response.list.concat(response.list,yield exports.processListItem(list.target.selector))}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_1)throw e_1.error}}return response}})),exports.processLoadMoreButton=(setup,response,callback)=>__awaiter(void 0,void 0,void 0,(function*(){var e_2,_d;try{for(var _f,_e=__asyncValues(setup.lists);!(_f=yield _e.next()).done;){const list=_f.value;response=response.concat(response,yield exports.processListItem(list.target.selector))}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_f&&!_f.done&&(_d=_e.return)&&(yield _d.call(_e))}finally{if(e_2)throw e_2.error}}const loadMore=document.querySelector(setup.navigation.loadMoreSelector);if(!loadMore)return callback(response),response;loadMore.click(),setTimeout((function(){exports.processLoadMoreButton(setup,response,callback)}),1e3)})),exports.processScrollToBottom=(setup,response,callback)=>__awaiter(void 0,void 0,void 0,(function*(){var e_3,_g;yield scrollToBottom_1.default(window.document.body,500);try{for(var _j,_h=__asyncValues(setup.lists);!(_j=yield _h.next()).done;){const list=_j.value;response=response.concat(response,yield exports.processListItem(list.target.selector))}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_j&&!_j.done&&(_g=_h.return)&&(yield _g.call(_h))}finally{if(e_3)throw e_3.error}}return callback(response),response})),exports.processListItem=selector=>{let response=[];return new Promise(((resolve,reject)=>__awaiter(void 0,void 0,void 0,(function*(){var e_4,_a;const listTarget=document.querySelectorAll(selector);try{try{for(var listTarget_1_1,listTarget_1=__asyncValues(listTarget);!(listTarget_1_1=yield listTarget_1.next()).done;){const listTar=listTarget_1_1.value;(yield exports.getItem(listTar))&&response.push()}}catch(e_4_1){e_4={error:e_4_1}}finally{try{listTarget_1_1&&!listTarget_1_1.done&&(_a=listTarget_1.return)&&(yield _a.call(listTarget_1))}finally{if(e_4)throw e_4.error}}resolve(response)}catch(err){reject(err)}}))))},exports.getItem=listTar=>new Promise(((resolve,reject)=>__awaiter(void 0,void 0,void 0,(function*(){try{if(listTar.classList.contains("bigeProcessed"))resolve(null);else{yield scrollToElement_1.default(window.document.body,listTar),listTar.classList.add("bigeProcessed");const scheme=yield productScheme_1.default(listTar);resolve(scheme)}}catch(err){reject("fail")}}))));